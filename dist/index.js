import{onHide as t,onUnload as e,onLaunch as n,onLoad as r,onShow as o,onReady as a}from"@dcloudio/uni-app";import{onUnmounted as i,onMounted as u}from"vue";var c,s=function(){return s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},s.apply(this,arguments)};function p(t,e,n,r){return new(n||(n=Promise))((function(o,a){function i(t){try{c(r.next(t))}catch(t){a(t)}}function u(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,u)}c((r=r.apply(t,e||[])).next())}))}function f(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}function l(t,e){return Array.isArray(t)||(t=[t]),t.join("-")+"-".concat(e)}"function"==typeof SuppressedError&&SuppressedError,function(t){t.PENDING="pending",t.FULFILLED="fulfilled"}(c||(c={}));var h=new(function(){function t(){this.watchConfigs={},this.promiseCache={},this.promiseMap={}}return t.prototype.createPendingPromise=function(t){var e=this;return new Promise((function(n,r){e.promiseMap[t.key]={status:c.PENDING,resolve:n,onUpdate:t.onUpdate}}))},t.prototype.updateWatchedValue=function(t,e,n){var r=this,o=n?"".concat(n,".").concat(t):t,a=[o];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){a.push("".concat(o,".").concat(t))})),a.forEach((function(t){var n,o;if(r.promiseMap[t])if(r.promiseMap[t].onUpdate){var a=null===(o=(n=r.promiseMap[t]).onUpdate)||void 0===o?void 0:o.call(n,e);a&&r.promiseMap[t].status==c.PENDING?(r.promiseMap[t].status=c.FULFILLED,r.promiseMap[t].resolve(e)):a||r.promiseMap[t].status!=c.FULFILLED||(r.promiseCache[t]=r.createPendingPromise({key:t,onUpdate:r.promiseMap[t].onUpdate}))}else e&&r.promiseMap[t].status==c.PENDING?(r.promiseMap[t].status=c.FULFILLED,r.promiseMap[t].resolve(e)):e||r.promiseMap[t].status!=c.FULFILLED||(r.promiseCache[t]=r.createPendingPromise({key:t,onUpdate:r.promiseMap[t].onUpdate}))}))},t.prototype.createProxy=function(t){var e=this;return new Proxy(t,{get:function(n,r,o){var a=Reflect.get(t,r,o);return"object"==typeof a&&null!==a?e.createProxy(s({_parentTarget:r},a)):(e.updateWatchedValue(r,a,n._parentTarget?n._parentTarget:null),a)},set:function(t,n,r){return t[n]=r,e.updateWatchedValue(n,r,t._parentTarget?t._parentTarget:null),!0}})},t.prototype.init=function(t){var e=this;this.watchConfigs=Object.assign({},t),Object.values(this.watchConfigs).forEach((function(t){if("pinia"===t.type){var n=function(t,e){return"pinia-".concat(e.$id,"-").concat(t)}(t.key,t.store);t.key=n,t.store.$subscribe((function(t){var r=t.events.newValue;e.updateWatchedValue(n,r)}))}var r=t.key,o=t.onUpdate;r?e.promiseCache[r]=e.createPendingPromise({key:r,onUpdate:o}):console.error("init 方法无效的监听配置：缺少 key 属性")}))},t.prototype.getPromiseCache=function(){return this.promiseCache},t.prototype.getPromiseMap=function(){return this.promiseMap},t.prototype.getWatchConfigs=function(){return this.watchConfigs},t}());function m(t){h.init(t)}var y=function(t){return h.createProxy(t)},v=function(t){return y(t)},d={};function x(t,e,n){var r=l(t,e);d[r]={},d[r].promise=new Promise((function(t,e){d[r].reject=e}));var o=function(t,e){var n=Array.isArray(t)?t:[t],r=h.getWatchConfigs();return n.filter((function(t){return t in r||(console.error("Method: ".concat(e,", Error: 监听的值【").concat(t,"】未注册！！！请检查init方法")),!1)}))}(t,n),a=h.getPromiseMap(),i=h.getWatchConfigs(),u=h.getPromiseCache();if(0==o.length)return Promise.reject();var s=o.map((function(t){var e=i[t].key;return a[e].status==c.FULFILLED?Promise.resolve:u[e]}));return Promise.race([Promise.all(s),d[r].promise])}function g(t,e,n,r){var o=this,a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}));t((function(){}),(function(t){return p(o,void 0,void 0,(function(){return f(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,x(n,a,r)];case 1:return o.sent(),e(t),[3,3];case 2:return o.sent(),[3,3];case 3:return[2]}}))}))}),(function(){!function(t,e){var n=l(t,e),r=d[n];r&&(r.reject(),delete d[n])}(n,a)}))}var P=function(t,e){return function(n,r){return g(t,n,r,e)}},b=P((function(e,r,o){var a=n;o&&t(o),a((function(t){e(t),null==r||r(t)}))}),"onCustomLaunch"),w=P((function(t,n,o){var a=r;o&&e(o),a((function(e){t(e),null==n||n(e)}))}),"onCustomLoad"),C=P((function(n,r,a){var i=o;a&&t(a),a&&e(a),i((function(){n(),null==r||r()}))}),"onCustomShow"),M=P((function(t,n,r){t(),null==n||n(),r&&i(r),r&&e(r)}),"onCustomCreated"),L=P((function(t,e,n){var r=u;n&&i(n),r((function(){t(),null==e||e()}))}),"onCustomMounted"),E=P((function(t,n,r){var o=a;r&&e(r),o((function(){t(),null==n||n()}))}),"onCustomReady");export{y as createProxy,h as customHooks,m as init,M as onCustomCreated,b as onCustomLaunch,w as onCustomLoad,L as onCustomMounted,E as onCustomReady,C as onCustomShow,v as proxyData};
