import{watch as t,onUnmounted as e,onMounted as n}from"vue";import{onUnload as r,onHide as o,onLaunch as i,onLoad as a,onShow as u,onReady as c}from"@dcloudio/uni-app";var s,p=function(){return p=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},p.apply(this,arguments)};function f(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function u(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}c((r=r.apply(t,e||[])).next())}))}function l(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}function h(t,e){return Array.isArray(t)||(t=[t]),t.join("-")+"-".concat(e)}"function"==typeof SuppressedError&&SuppressedError,function(t){t.PENDING="pending",t.FULFILLED="fulfilled"}(s||(s={}));var m=new(function(){function e(){this.watchConfigs={},this.promiseCache={},this.promiseMap={}}return e.prototype.createPendingPromise=function(t){var e=this;return new Promise((function(n,r){e.promiseMap[t.key]={status:s.PENDING,resolve:n,onUpdate:t.onUpdate}}))},e.prototype.updateWatchedValue=function(t,e,n){var r=this,o=n?"".concat(n,".").concat(t):t,i=[o];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){i.push("".concat(o,".").concat(t))})),i.forEach((function(t){var n,o;if(r.promiseMap[t])if(r.promiseMap[t].onUpdate){var i=null===(o=(n=r.promiseMap[t]).onUpdate)||void 0===o?void 0:o.call(n,e);i&&r.promiseMap[t].status==s.PENDING?(r.promiseMap[t].status=s.FULFILLED,r.promiseMap[t].resolve(e)):i||r.promiseMap[t].status!=s.FULFILLED||(r.promiseCache[t]=r.createPendingPromise({key:t,onUpdate:r.promiseMap[t].onUpdate}))}else e&&r.promiseMap[t].status==s.PENDING?(r.promiseMap[t].status=s.FULFILLED,r.promiseMap[t].resolve(e)):e||r.promiseMap[t].status!=s.FULFILLED||(r.promiseCache[t]=r.createPendingPromise({key:t,onUpdate:r.promiseMap[t].onUpdate}))}))},e.prototype.createProxy=function(t){var e=this;return new Proxy(t,{get:function(n,r,o){var i=Reflect.get(t,r,o);return"object"==typeof i&&null!==i?e.createProxy(p({_parentTarget:r},i)):(e.updateWatchedValue(r,i,n._parentTarget?n._parentTarget:null),i)},set:function(n,r,o){var i=Reflect.set(t,r,o);return e.updateWatchedValue(r,o,n._parentTarget?n._parentTarget:null),i}})},e.prototype.init=function(e){var n=this;this.watchConfigs=Object.assign({},e),Object.values(this.watchConfigs).forEach((function(e){if("pinia"===e.type){var r=e.key,o=function(t,e){return"pinia-".concat(e.$id,"-").concat(t)}(e.key,e.store);e.key=o,function(e,n,r){t((function(){return e.$state[n]}),(function(t){r(t)}),{immediate:!1})}(e.store,r,(function(t){n.updateWatchedValue(o,t)}))}var i=e.key,a=e.onUpdate;i?n.promiseCache[i]=n.createPendingPromise({key:i,onUpdate:a}):console.error("init 方法无效的监听配置：缺少 key 属性")}))},e.prototype.getPromiseCache=function(){return this.promiseCache},e.prototype.getPromiseMap=function(){return this.promiseMap},e.prototype.getWatchConfigs=function(){return this.watchConfigs},e}());function y(t){m.init(t)}var d=function(t){return m.createProxy(t)},v=function(t){return d(t)};function x(t,e,n,r,o){void 0===o&&(o=[]),r&&o.forEach((function(t){return t(r)})),t((function(t){e(t),null==n||n(t)}))}var g={};function P(t,e,n){var r=h(t,e);g[r]={},g[r].promise=new Promise((function(t,e){g[r].reject=e}));var o=function(t,e){var n=Array.isArray(t)?t:[t],r=m.getWatchConfigs();return n.filter((function(t){return t in r||(console.error("Method: ".concat(e,", Error: 监听的值【").concat(t,"】未注册！！！请检查init方法")),!1)}))}(t,n),i=m.getPromiseMap(),a=m.getWatchConfigs(),u=m.getPromiseCache();if(0==o.length)return Promise.reject();var c=o.map((function(t){var e=a[t].key;return i[e].status==s.FULFILLED?Promise.resolve:u[e]}));return Promise.race([Promise.all(c),g[r].promise])}function b(t,e,n,r){var o=this,i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}));t((function(){}),(function(t){return f(o,void 0,void 0,(function(){return l(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,P(n,i,r)];case 1:return o.sent(),e(t),[3,3];case 2:return o.sent(),[3,3];case 3:return[2]}}))}))}),(function(){!function(t,e){var n=h(t,e),r=g[n];r&&(r.reject(),delete g[n])}(n,i)}))}var w=function(t,e){return function(n,r){return b(t,n,r,e)}},C=w((function(t,e,n){x(i,t,e,n,[o])}),"onCustomLaunch"),M=w((function(t,e,n){x(a,t,e,n,[r])}),"onCustomLoad"),L=w((function(t,e,n){x(u,t,e,n,[o,r])}),"onCustomShow"),E=w((function(t,n,o){t(),null==n||n(),o&&[e,r].forEach((function(t){return t(o)}))}),"onCustomCreated"),U=w((function(t,r,o){x(n,t,r,o,[e])}),"onCustomMounted"),k=w((function(t,e,n){x(c,t,e,n,[r])}),"onCustomReady");export{d as createProxy,m as customHooks,y as init,E as onCustomCreated,C as onCustomLaunch,M as onCustomLoad,U as onCustomMounted,k as onCustomReady,L as onCustomShow,v as proxyData};
