import{onHide as n,onUnload as t,onLaunch as e,onLoad as r,onShow as o,onReady as a}from"@dcloudio/uni-app";import{onUnmounted as u,onMounted as c}from"vue";var i,f=function(){return f=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},f.apply(this,arguments)};function s(n,t,e,r){return new(e||(e=Promise))((function(o,a){function u(n){try{i(r.next(n))}catch(n){a(n)}}function c(n){try{i(r.throw(n))}catch(n){a(n)}}function i(n){var t;n.done?o(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(u,c)}i((r=r.apply(n,t||[])).next())}))}function l(n,t){var e,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=c(0),u.throw=c(1),u.return=c(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function c(c){return function(i){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;u&&(u=0,c[0]&&(a=0)),a;)try{if(e=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(n,a)}catch(n){c=[6,n],r=0}finally{e=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,i])}}}"function"==typeof SuppressedError&&SuppressedError,function(n){n.PEDDING="pedding",n.FULFILLED="fulfilled"}(i||(i={}));var p={},v={},y={};function x(n){return new Promise((function(t,e){y[n.key]={status:i.PEDDING,resolve:t,onUpdate:n.onUpdate}}))}function d(n,t,e){var r=e?"".concat(e,".").concat(n):n,o=[r];"object"==typeof t&&null!==t&&Object.keys(t).forEach((function(n){o.push("".concat(r,".").concat(n))})),o.forEach((function(n){var e,r;if(y[n])if(y[n].onUpdate){var o=null===(r=(e=y[n]).onUpdate)||void 0===r?void 0:r.call(e,t);o&&y[n].status==i.PEDDING?(y[n].status=i.FULFILLED,y[n].resolve(t)):o||y[n].status!=i.FULFILLED||(v[n]=x({key:n,onUpdate:y[n].onUpdate}))}else t&&y[n].status==i.PEDDING?(y[n].status=i.FULFILLED,y[n].resolve(t)):t||y[n].status!=i.FULFILLED||(v[n]=x({key:n,onUpdate:y[n].onUpdate}))}))}var h=function(n){return new Proxy(n,{get:function(t,e,r){var o=Reflect.get(n,e,r);return"object"==typeof o&&null!==o?h(f({_parentTarget:e},o)):(d(e,o,t._parentTarget?t._parentTarget:null),o)},set:function(n,t,e){return n[t]=e,d(t,e,n._parentTarget?n._parentTarget:null),!0}})};function b(n,t){p=Object.assign({},n);for(var e=0,r=Object.keys(n).map((function(t){return n[t]}));e<r.length;e++){var o=r[e];o.key="pinia"==o.type?"pinia-".concat(o.key):o.key,v[o.key]=x(o)}t&&t.$subscribe((function(n){var t=n.events.key,e=n.events.newValue;d("pinia-".concat(t),e)}))}function m(n,t){return Array.isArray(n)||(n=[n]),n.join("-")+"-".concat(t)}var k={};function L(n,t){return(Array.isArray(n)?n:[n]).filter((function(n){if(n in p)return!0;console.error({method:t,key:n,error:"监听的值未注册，该key值不生效，请检查init方法"});var e=function(){var n=(new Error).stack;if(!n)return"Unknown location";var t=n.split("\n").find((function(n){return!n.includes("getErrorLocation")&&!n.includes("getWatchKey")}));if(!t)return"Unknown location";var e=t.match(/at\s+(.+)/);return e?e[1].trim():"Unknown location"}();return console.error("Method: ".concat(t,", Key: ").concat(n,", Location: ").concat(e,', Error: "监听的值未注册，该key值不生效，请检查init方法"')),!1}))}function w(n,t,e){var r=m(n,t);k[r]={},k[r].promise=new Promise((function(n,t){k[r].reject=t}));var o=L(n,e).map((function(n){var t=p[n].key;return y[t].status==i.FULFILLED?Promise.resolve:v[t]}));return Promise.race([Promise.all(o),k[r].promise])}function g(n,t,e,r){var o=this,a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){var t=16*Math.random()|0;return("x"==n?t:3&t|8).toString(16)}));n((function(){}),(function(n){return s(o,void 0,void 0,(function(){return l(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,w(e,a,r)];case 1:return o.sent(),t(n),[3,3];case 2:return o.sent(),[3,3];case 3:return[2]}}))}))}),(function(){!function(n,t){var e=m(n,t),r=k[e];r&&(r.reject(),delete k[e])}(e,a)}))}var E=function(n,t){return function(e,r){return g(n,e,r,t)}},U=E((function(t,r,o){var a=e;o&&n(o),a((function(n){t(n),null==r||r(n)}))}),"onCustomLaunch"),D=E((function(n,e,o){var a=r;o&&t(o),a((function(t){n(t),null==e||e(t)}))}),"onCustomLoad"),j=E((function(e,r,a){var u=o;a&&n(a),a&&t(a),u((function(){e(),null==r||r()}))}),"onCustomShow"),F=E((function(n,e,r){n(),null==e||e(),r&&u(r),r&&t(r)}),"onCustomCreated"),I=E((function(n,t,e){var r=c;e&&u(e),r((function(){n(),null==t||t()}))}),"onCustomMounted"),P=E((function(n,e,r){var o=a;r&&t(r),o((function(){n(),null==e||e()}))}),"onCustomReady");export{b as init,v as keyPromise,F as onCustomCreated,U as onCustomLaunch,D as onCustomLoad,I as onCustomMounted,P as onCustomReady,j as onCustomShow,y as promiseMap,h as proxyData,p as watchObj};
